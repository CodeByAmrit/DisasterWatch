<%- include('../layouts/header', { 
    title: 'Disaster Dashboard',
    isAuthenticated: false,
    isAdmin: false,
    userInitials: ''
}); %>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Page header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">Disaster Alert Dashboard</h1>
        <p class="mt-2 text-gray-600">Real-time updates on active disasters and emergency situations</p>
    </div>

    <!-- Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-red-100 text-red-600 mr-4">
                    <i class="fas fa-exclamation-triangle text-xl"></i>
                </div>
                <div>
                    <h3 class="text-gray-500 text-sm font-medium">Severe Alerts</h3>
                    <p class="text-2xl font-bold text-gray-900"><%= alertsCount.severe %></p>
                </div>
            </div>
        </div>
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-yellow-100 text-yellow-600 mr-4">
                    <i class="fas fa-exclamation-circle text-xl"></i>
                </div>
                <div>
                    <h3 class="text-gray-500 text-sm font-medium">Moderate Alerts</h3>
                    <p class="text-2xl font-bold text-gray-900"><%= alertsCount.moderate %></p>
                </div>
            </div>
        </div>
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-green-100 text-green-600 mr-4">
                    <i class="fas fa-info-circle text-xl"></i>
                </div>
                <div>
                    <h3 class="text-gray-500 text-sm font-medium">Affected Countries</h3>
                    <p class="text-2xl font-bold text-gray-900"><%= countriesCount %></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Alerts Section -->
    <div class="bg-white shadow rounded-lg overflow-hidden mb-8">
        <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-medium text-gray-900">Recent Disaster Alerts</h2>
        </div>
        <div class="divide-y divide-gray-200">
            <% if (alerts.length > 0) { %>
                <% alerts.forEach(alert => { %>
                    <div class="p-6 alert-card <%= 'severity-' + (alert.severity_enum ? alert.severity_enum.toLowerCase() : 'low') %>">
                        <div class="flex flex-col md:flex-row md:items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-<%= alert.severity_enum === 'SEVERE' ? 'red' : alert.severity_enum === 'MODERATE' ? 'yellow' : 'green' %>-100 text-<%= alert.severity_enum === 'SEVERE' ? 'red' : alert.severity_enum === 'MODERATE' ? 'yellow' : 'green' %>-800 mr-2">
                                        <%= alert.severity_enum || 'MINOR' %>
                                    </span>
                                    <h3 class="text-lg font-medium text-gray-900"><%= alert.title %></h3>
                                </div>
                                <p class="mt-1 text-gray-600"><%= alert.description %></p>
                                <div class="mt-2 flex flex-wrap gap-2">
                                    <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                        <i class="fas fa-map-marker-alt mr-1"></i> <%= alert.location || 'Unknown' %>
                                    </span>
                                    <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-purple-100 text-purple-800">
                                        <i class="fas fa-calendar-alt mr-1"></i> <%= new Date(alert.created_at).toLocaleDateString() %>
                                    </span>
                                    <% if (alert.country) { %>
                                        <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800">
                                            <i class="fas fa-globe mr-1"></i> <%= alert.country %>
                                        </span>
                                    <% } %>
                                </div>
                            </div>
                            <div class="mt-4 md:mt-0 md:ml-4">
                                <a href="/alert/<%= alert.id %>" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    View Details
                                </a>
                            </div>
                        </div>
                    </div>
                <% }); %>
            <% } else { %>
                <div class="p-6 text-center text-gray-500">
                    <i class="fas fa-info-circle text-3xl mb-2 text-gray-400"></i>
                    <p>No active disaster alerts at this time.</p>
                </div>
            <% } %>
        </div>
    </div>

    <!-- Pagination -->
    <% if (pagination.totalPages > 1) { %>
        <div class="flex items-center justify-between border-t border-gray-200 px-4 py-3 sm:px-6">
            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                <div>
                    <p class="text-sm text-gray-700">
                        Showing <span class="font-medium"><%= pagination.from %></span> to <span class="font-medium"><%= pagination.to %></span> of <span class="font-medium"><%= pagination.total %></span> results
                    </p>
                </div>
                <div>
                    <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                        <% if (pagination.currentPage > 1) { %>
                            <a href="/dashboard?page=<%= pagination.currentPage - 1 %>&limit=<%= limit %>" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                <span class="sr-only">Previous</span>
                                <i class="fas fa-chevron-left"></i>
                            </a>
                        <% } %>
                        
                        <% for (let i = 1; i <= pagination.totalPages; i++) { %>
                            <a href="/dashboard?page=<%= i %>&limit=<%= limit %>" class="relative inline-flex items-center px-4 py-2 border <%= i === pagination.currentPage ? 'border-blue-500 bg-blue-50 text-blue-600 z-10' : 'border-gray-300 bg-white text-gray-500 hover:bg-gray-50' %> text-sm font-medium">
                                <%= i %>
                            </a>
                        <% } %>
                        
                        <% if (pagination.currentPage < pagination.totalPages) { %>
                            <a href="/dashboard?page=<%= pagination.currentPage + 1 %>&limit=<%= limit %>" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                <span class="sr-only">Next</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                        <% } %>
                    </nav>
                </div>
            </div>
        </div>
    <% } %>
</div>

<%- include('../layouts/footer'); %>